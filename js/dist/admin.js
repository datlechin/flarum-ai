/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),i=r(996),s=r(312),a=r(166),u=r(766),l=r(760);function c(){"use strict";var e=o(),r=e.m(c),d=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function m(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function f(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,p[t],e)},delegateYield:function(t,o,i){return e.resultName=o,r(n.d,l(t),i)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(f(t),r,n,o&&o.reverse())},isGeneratorFunction:m,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:a,async:function(t,e,r,n,o){return(m(e)?s:i)(f(t),e,r,n,o)},keys:u,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function u(t,o,i,s){var a=o&&o.prototype instanceof c?o:c,u=Object.create(a.prototype);return n(u,"_invoke",function(t,n,o){var i,s,a,u=0,c=o||[],d=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,s=0,a=e,m.n=r,l}};function p(t,n){for(s=t,a=n,r=0;!d&&u&&!o&&r<c.length;r++){var o,i=c[r],p=m.p,f=i[2];t>3?(o=f===n)&&(a=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(s=0,m.v=n,m.n=i[1]):p<f&&(o=t<3||i[0]>n||n>f)&&(i[4]=t,i[5]=n,m.n=f,s=0))}if(o||t>1)return l;throw d=!0,n}return function(o,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,f),s=c,a=f;(r=s<2?e:a)||!d;){i||(s?s<3?(s>1&&(m.n=-1),p(s,a)):m.n=a:m.v=a);try{if(u=2,i){if(s||(o="next"),r=i[o]){if(!(r=r.call(i,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,s<2&&(s=0)}else 1===s&&(r=i.return)&&r.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((r=(d=m.n<0)?a:t.call(n,m))!==l)break}catch(t){i=e,s=1,a=t}finally{u=1}}return{value:r,done:d}}}(t,i,s),!0),u}var l={};function c(){}function d(){}function m(){}r=Object.getPrototypeOf;var p=[][s]?r(r([][s]())):(n(r={},s,function(){return this}),r),f=m.prototype=c.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,n(t,a,"GeneratorFunction")),t.prototype=Object.create(f),t}return d.prototype=m,n(f,"constructor",m),n(m,"constructor",d),d.displayName="GeneratorFunction",n(m,a,"GeneratorFunction"),n(f),n(f,a,"Generator"),n(f,s,function(){return this}),n(f,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:u,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function i(t,o,s,a){try{var u=e[t](o),l=u.value;return l instanceof n?r.resolve(l.v).then(function(t){i("next",t,s,a)},function(t){i("throw",t,s,a)}):r.resolve(l).then(function(t){u.value=t,s(u)},function(t){return i("throw",t,s,a)})}catch(t){a(t)}}var s;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){i(t,n,e,r)})}return s=s?s.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,i,s){return new o(n().w(t,e,r,i),s||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,i){var s=Object.defineProperty;try{s({},"",{})}catch(r){s=0}t.exports=e=function(t,r,n,o){function i(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?s?s(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(i("next",0),i("throw",1),i("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,i){var s=n(t,e,r,o,i);return s.next().then(function(t){return t.done?t.value:s.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["admin/app"];var e=r.n(t);function n(t,e,r,n,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise(function(o,i){var s=t.apply(e,r);function a(t){n(s,o,i,a,u,"next",t)}function u(t){n(s,o,i,a,u,"throw",t)}a(void 0)})}}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var s=r(183),a=r.n(s);const u=flarum.core.compat["admin/components/ExtensionPage"];var l=r.n(u);const c=flarum.core.compat["common/components/Button"];var d=r.n(c);const p=flarum.core.compat["common/components/Select"];var f=r.n(p);const h=flarum.core.compat["common/utils/Stream"];var v=r.n(h),g=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).catalog={},e.currentProvider=v()("openai"),e.textModel=v()("gpt-4o-mini"),e.embeddingsModel=v()("text-embedding-3-small"),e.moderationModel=v()("omni-moderation-latest"),e.customTextModel=v()(""),e.customEmbeddingsModel=v()(""),e.customModerationModel=v()(""),e.isTestingText=v()(!1),e.isTestingEmbeddings=v()(!1),e.isTestingModeration=v()(!1),e}var n,s;s=t,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,i(n,s);var u=r.prototype;return u.oninit=function(e){t.prototype.oninit.call(this,e),this.currentProvider(this.setting("datlechin-ai.provider","openai")());var r=this.setting("datlechin-ai.models.selected.text","gpt-4o-mini")(),n=this.setting("datlechin-ai.models.custom.text","")();this.textModel(r),this.customTextModel(n);var o=this.setting("datlechin-ai.models.selected.embeddings","text-embedding-3-small")(),i=this.setting("datlechin-ai.models.custom.embeddings","")();this.embeddingsModel(o),this.customEmbeddingsModel(i);var s=this.setting("datlechin-ai.models.selected.moderation","omni-moderation-latest")(),a=this.setting("datlechin-ai.models.custom.moderation","")();this.moderationModel(s),this.customModerationModel(a),this.loadCatalog()},u.loadCatalog=function(){var t=o(a().mark(function t(){var r,n;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/ai/provider-catalog"});case 1:(r=t.sent)&&r.success&&(this.catalog=r.data,this.customTextModel()&&this.textModel("__custom__"),this.customEmbeddingsModel()&&this.embeddingsModel("__custom__"),this.customModerationModel()&&this.moderationModel("__custom__"),m.redraw()),t.next=3;break;case 2:t.prev=2,n=t.catch(0),console.error("Failed to load provider catalog:",n);case 3:case"end":return t.stop()}},t,this,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),u.content=function(){var t=this;return m("div",{className:"AISettingsPage"},m("div",{className:"container"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,e().translator.trans("datlechin-ai.admin.settings.provider_label")),m(f(),{value:this.currentProvider(),options:{openai:e().translator.trans("datlechin-ai.admin.settings.provider_openai"),gemini:e().translator.trans("datlechin-ai.admin.settings.provider_gemini"),anthropic:e().translator.trans("datlechin-ai.admin.settings.provider_anthropic")},onchange:function(e){t.currentProvider(e),t.setting("datlechin-ai.provider")(e),t.updateModelsForProvider(e)}})),m("div",{className:"Form-group"},m("label",null,e().translator.trans("datlechin-ai.admin.settings.api_key_label",{provider:this.currentProvider()})),this.buildSettingComponent({type:"text",setting:"datlechin-ai."+this.currentProvider()+".api_key",placeholder:e().translator.trans("datlechin-ai.admin.settings.api_key_placeholder",{provider:this.currentProvider()})})),m("div",{className:"Form-group"},m("label",null,e().translator.trans("datlechin-ai.admin.settings.base_url_label")),this.buildSettingComponent({type:"text",setting:"datlechin-ai."+this.currentProvider()+".base_url",placeholder:e().translator.trans("datlechin-ai.admin.settings.base_url_placeholder")})),this.renderModelSelect("text",this.textModel,this.customTextModel),this.hasCapability("embeddings")&&this.renderModelSelect("embeddings",this.embeddingsModel,this.customEmbeddingsModel),"openai"===this.currentProvider()&&this.renderModelSelect("moderation",this.moderationModel,this.customModerationModel),m("div",{className:"Form-group"},m(d(),{className:"Button",onclick:function(){return t.testTextModel()},loading:this.isTestingText(),disabled:this.isTestingText()},e().translator.trans("datlechin-ai.admin.settings.test_text_button"))," ",this.hasCapability("embeddings")&&m(d(),{className:"Button",onclick:function(){return t.testEmbeddings()},loading:this.isTestingEmbeddings(),disabled:this.isTestingEmbeddings()},e().translator.trans("datlechin-ai.admin.settings.test_embeddings_button"))," ","openai"===this.currentProvider()&&m("[",null,m(d(),{className:"Button",onclick:function(){return t.testModeration()},loading:this.isTestingModeration(),disabled:this.isTestingModeration()},e().translator.trans("datlechin-ai.admin.settings.test_moderation_button"))," ")),this.submitButton())))},u.renderModelSelect=function(t,r,n){var o=this,i=this.currentProvider(),s=this.catalog[i];if(null==s||!s[t])return null;var a=s[t]||[],u={};a.forEach(function(t){u[t.value]=t.label}),u.__custom__="Custom Model";var l="__custom__"===r();return m("div",{className:"Form-group"},m("label",null,e().translator.trans("datlechin-ai.admin.settings."+t+"_model_label")),m("span",{class:"Select"},m("select",{className:"Select-input FormControl",value:r(),onchange:function(e){var i=e.target.value;r(i),o.setting("datlechin-ai.models.selected."+t)(i),"__custom__"!==i&&(n(""),o.setting("datlechin-ai.models.custom."+t)("")),m.redraw()}},Object.keys(u).map(function(t){return m("option",{value:t,selected:t===r()},u[t])})),m("i",{"aria-hidden":"true",class:"icon fas fa-sort Select-caret"})),l&&m("div",{className:"Form-group",style:{marginTop:"10px"}},m("input",{type:"text",className:"FormControl",placeholder:e().translator.trans("datlechin-ai.admin.settings.custom_model_placeholder"),value:n(),oninput:function(e){n(e.target.value),o.setting("datlechin-ai.models.custom."+t)(e.target.value)}})))},u.updateModelsForProvider=function(t){var e,r,n,o,i,s,a=this.catalog[t];if(a){var u=(null==(e=a.text)||null==(e=e.find(function(t){return t.is_default}))?void 0:e.value)||(null==(r=a.text)||null==(r=r[0])?void 0:r.value),l=(null==(n=a.embeddings)||null==(n=n.find(function(t){return t.is_default}))?void 0:n.value)||(null==(o=a.embeddings)||null==(o=o[0])?void 0:o.value),c=(null==(i=a.moderation)||null==(i=i.find(function(t){return t.is_default}))?void 0:i.value)||(null==(s=a.moderation)||null==(s=s[0])?void 0:s.value);u&&!this.customTextModel()&&(this.textModel(u),this.setting("datlechin-ai.models.selected.text")(u)),l&&!this.customEmbeddingsModel()&&(this.embeddingsModel(l),this.setting("datlechin-ai.models.selected.embeddings")(l)),c&&!this.customModerationModel()&&(this.moderationModel(c),this.setting("datlechin-ai.models.selected.moderation")(c)),m.redraw()}},u.hasCapability=function(t){var e=this.currentProvider(),r=this.catalog[e];return!!r&&Array.isArray(r[t])&&r[t].length>0},u.testTextModel=function(){var t=o(a().mark(function t(){var r,n;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isTestingText()){t.next=1;break}return t.abrupt("return");case 1:return this.isTestingText(!0),m.redraw(),t.prev=2,t.next=3,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/ai/generate",body:{messages:[{role:"user",content:"Hello! Please respond with a brief greeting."}]}});case 3:(r=t.sent)&&r.success&&e().alerts.show({type:"success"},e().translator.trans("datlechin-ai.admin.settings.test_success")),t.next=5;break;case 4:t.prev=4,n=t.catch(2),e().alerts.show({type:"error"},e().translator.trans("datlechin-ai.admin.settings.test_failed",{error:n.message}));case 5:return t.prev=5,this.isTestingText(!1),m.redraw(),t.finish(5);case 6:case"end":return t.stop()}},t,this,[[2,4,5,6]])}));return function(){return t.apply(this,arguments)}}(),u.testEmbeddings=function(){var t=o(a().mark(function t(){var r,n;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isTestingEmbeddings()){t.next=1;break}return t.abrupt("return");case 1:return this.isTestingEmbeddings(!0),m.redraw(),t.prev=2,t.next=3,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/ai/embeddings",body:{texts:["This is a test embedding."]}});case 3:(r=t.sent)&&r.success&&e().alerts.show({type:"success"},e().translator.trans("datlechin-ai.admin.settings.test_success")),t.next=5;break;case 4:t.prev=4,n=t.catch(2),e().alerts.show({type:"error"},e().translator.trans("datlechin-ai.admin.settings.test_failed",{error:n.message}));case 5:return t.prev=5,this.isTestingEmbeddings(!1),m.redraw(),t.finish(5);case 6:case"end":return t.stop()}},t,this,[[2,4,5,6]])}));return function(){return t.apply(this,arguments)}}(),u.testModeration=function(){var t=o(a().mark(function t(){var r,n;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isTestingModeration()){t.next=1;break}return t.abrupt("return");case 1:return this.isTestingModeration(!0),m.redraw(),t.prev=2,t.next=3,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/ai/moderate",body:{text:"This is a test message for moderation."}});case 3:(r=t.sent)&&r.success&&e().alerts.show({type:"success"},e().translator.trans("datlechin-ai.admin.settings.test_success")),t.next=5;break;case 4:t.prev=4,n=t.catch(2),e().alerts.show({type:"error"},e().translator.trans("datlechin-ai.admin.settings.test_failed",{error:n.message}));case 5:return t.prev=5,this.isTestingModeration(!1),m.redraw(),t.finish(5);case 6:case"end":return t.stop()}},t,this,[[2,4,5,6]])}));return function(){return t.apply(this,arguments)}}(),r}(l());e().initializers.add("nqd/ai-core",function(){e().extensionData.for("datlechin-ai").registerPage(g)})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map